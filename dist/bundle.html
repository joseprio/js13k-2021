<!doctype html><title>Galaxy Raid</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1.01"><meta name=monetization content=$ilp.uphold.com/ARgDFUGHFJ8Y><style>body,html{width:100%;height:100%;margin:0;padding:0;background:#000;overflow:hidden}#b,#g,#i,#p,#s,#t,body,html{touch-action:none;user-select:none;-webkit-user-select:none}#h,body{display:flex;align-items:center;justify-content:center}#g,#h{position:absolute;transform:scale(var(--s,.1));width:480px;height:700px;flex-direction:column}#b,#e,#i,#p,#s{position:absolute;font-size:20px}#i,#p,#s{top:0}#e{top:40px;height:15px;outline:3px solid #fff;border:2px solid transparent;transition:all .5s linear;opacity:0}#l{opacity:.6}#e,#i,#p{right:0}#b,#e,#p,#s{left:0}#b{bottom:0;transform:none}#c,#p{text-align:center}#e,button,p{color:#fff;font:400 30px Futura,"Trebuchet MS",Arial;transform:skew(6rad) scaleX(.7);margin:5px}#t{font-size:45px;text-transform:uppercase;text-shadow:0 0 5px #fff,0 0 20px #0ff}#t.b{font-size:70px}button{outline:3px solid #0ff;width:350px;height:50px;border:2px solid transparent;background:0 0;cursor:pointer;transition:all .3s ease;position:relative;margin:10px}button[d]{opacity:.5;outline-color:red}#l,button:before{position:absolute;top:0;bottom:0;left:0;width:0;transition:inherit;content:'';background:#0ff;z-index:-1}button:focus{color:#002}button:focus:before{width:100%}</style><canvas id=g></canvas><div id=h><p id=p><p id=s><div id=e><div id=l></div></div><p id=i><p id=b><p id=t><div id=c></div></div><script>function a(t,e,a){return Math.max(e,Math.min(a,t))}function r(t,e){return`rgb(${t.map(t=>t*e*100).join("%,")}%)`}function n(t,e,a){let l=(l,r=(l+6*t)%6)=>a-a*e*Math.max(Math.min(r,4-r,1),0);return[l(5),l(3),l(1)]}function f(t,e,a){return t*(a-e)+e}function h(t,e,a){return Math.floor(f(t,e,a+1))}function M(t,e,a){let l=0;for(;t()<e&&a>l;)l++;return l}function o(t,e){let a=0;for(let t=0;e.length>t;t++)a+=e[t];let l=t()*a;for(let t=0;e.length>t;t++)if(l-=e[t],0>=l)return t}function u(t){let e=new Uint32Array([Math.imul(t,2246822507),Math.imul(t,3266489909)]);return()=>{let t=e[0],a=e[1]^t;return e[0]=(t<<26|t>>8)^a^a<<9,e[1]=a<<13|a>>19,(Math.imul(t,2654435771)>>>0)/4294967295}}function d(t){return t.getContext("2d")}function S(t,e){let a=document.createElement("canvas");return a.width=t,a.height=e,[a,d(a)]}function m(t,e,a,l){t.beginPath(),t.arc(e,a,l,0,7),t.fill()}function v(t){return d(t).getImageData(0,0,t.width,t.height)}function y(t){let e=d(t),a=v(t),l=[],r=[];for(let t=0;a.width>t;t++)for(let e=0;a.height>e;e++)a.data[4*(e*a.width+t)+3]&&(l.push(t),r.push(e));let n=Math.min(...l),f=Math.min(...r),h=e.getImageData(n,f,1+Math.max(...l)-n,1+Math.max(...r)-f);return t.width=h.width,t.height=h.height,e.putImageData(h,0,0),t}function w(t,e,l,i){let c=u(l),s=u(t),d=u(e),p=[.8*f(d(),.001,1)*2**(8*d()),.9*f(d(),.001,1)*2**(8*d()),1*f(d(),.001,1)*2**(8*d()),3*d()*2**(8*d()),.5*d()*2**(8*d()),.05*d()*2**(8*d()),.5*d()*2**(8*d())],g=[],b=[],y=1+(.7>s()?1:0)+M(s,.3,3);for(let t=0;y>t;t++)g.push(n(s()**2,a(f(s(),-.2,1),0,s()**4),Math.max(f(s(),.7,1.1),1))),b.push(2**(6*s()));let w=s()/2,U=f(s(),0,.6),C=f(s(),0,.6),k=f(s(),0,.6),A=Math.floor(3*c()),O=i||f(c(),2.5,7)**3,T=f(c(),.5,1.3),x=f(c(),.7,1.7),$=f(c(),.1,1),B=f(c(),2,8),G=f(c(),.5,1.5),N=f(c(),.1,1),R=f(c(),10,50),q=f(c(),.5,1.5),D=f(c(),.03,.1),J=c()>.5?"round":"square",P=f(c(),.1,1),j=c(),I=d()>.5?1:2,L=d()/I,V=d(),W=d(),z=f(d(),-.2,1.2),E=d(),F=d(),H=f(d(),.5,.8),K=H-f(d(),.2,.4),Q=f(d(),0,.2),Y=o(d,b),X=f(d(),.02,.1),Z=d(),_=d(),tt=d(),et=f(d(),2,6),at=f(d(),2,7),lt=d(),rt=d(),nt=d(),ft=d(),ht=d(),Mt=f(d(),0,.8),ot=f(d(),.5,1.5),it=d(),ut=f(d(),.2,.9),ct=f(d(),-.2,-.05),st=f(d(),.1,3.5),dt=p.map(d),pt=p.map(d);function gt(){let t=g[o(s,b)];return s()<w**2?[a(t[0]+U**2*a(f(s(),-1,1.2),0,1)*a((.7>s()?-1:1)+(.7>s()?-1:1),-1,1),0,1),a(t[1]+C**2*a(f(s(),-1,1.2),0,1)*a((.7>s()?-1:1)+(.7>s()?-1:1),-1,1),0,1),a(t[2]+k**2*a(f(s(),-1,1.2),0,1)*a((.7>s()?-1:1)+(.7>s()?-1:1),-1,1),0,1)]:t}let St=Math.floor(O*T),mt=Math.floor(St/2),vt=Math.floor(St/6),bt=(St-6*vt)/2,yt=Math.floor(O*x),wt=Math.floor(yt/2),Ut=Math.floor(yt/6),Ct=(yt-6*Ut)/2,[kt,At]=S(St,yt),Ot=St*yt/20;if(0==A){let t=Math.ceil(St*$/5),e=[[[mt-t,0],[mt+t,yt]]],a=2+Math.floor(f(c(),.5,1)*B*O**.5);for(let t=1;a>t;t++){let t=e[h(c(),0,e.length-1)],a=[t[0][0]+c()*(t[1][0]-t[0][0]),t[0][1]+c()*(t[1][1]-t[0][1])];(t[0][1]+t[1][1])/2>a[1]&&c()<G&&(a[1]=t[1][1]-(a[1]-t[0][1]));let l=[c()*St,c()*yt],r=Ot/Math.abs((l[0]-a[0])*(l[1]-a[1]));if(1>r&&(l[0]=a[0]+(l[0]-a[0])*r,l[1]=a[1]+(l[1]-a[1])*r),a[0]>l[0]){let t=a[0];a[0]=l[0],l[0]=t}if(a[1]>l[1]){let t=a[1];a[1]=l[1],l[1]=t}e.push([[Math.floor(a[0]),Math.floor(a[1])],[Math.ceil(l[0]),Math.ceil(l[1])]])}At.fillStyle="#fff",e.map(t=>{At.fillRect(t[0][0],t[0][1],t[1][0]-t[0][0],t[1][1]-t[0][1]),At.fillRect(St-t[1][0],t[0][1],t[1][0]-t[0][0],t[1][1]-t[0][1])})}else if(1==A){let t=Math.max(2,(Ot/Math.PI)**.5),e=Math.ceil(St*N/5),a=[],l=Math.floor(yt/(2*e));for(let t=0;l>t;t++)a.push({t:[mt,yt-e*(2*t+1)],r:e});let r=l+Math.floor(f(c(),.5,1)*R*O**.5);for(let e=l;r>e;e++){let e=a[Math.max(h(c(),0,a.length-1),h(c(),0,a.length-1))],l=f(c(),1,t),r=f(c(),Math.max(0,e.r-l),e.r),n=f(c(),0,2*Math.PI);n>Math.PI&&c()<q&&(n=f(c(),0,Math.PI));let M=[e.t[0]+Math.cos(n)*r,e.t[1]+Math.sin(n)*r];l=Math.min(l,M[0],St-M[0],M[1],yt-M[1]),a.push({t:M,r:l})}At.fillStyle="#fff",a.map(t=>{m(At,t.t[0],t.t[1],t.r),m(At,St-t.t[0],t.t[1],t.r)})}else{let t=[[mt,f(c(),0,.05)*yt],[mt,f(c(),.95,1)*yt]],e=6/O+D,a=Math.max(3,Math.ceil(f(c(),.05,.1)/e*O**.5));At.lineCap=J,At.strokeStyle="#fff";for(let l=1;a>l;l++){let a=t[l];a||(a=[c()*St,c()**P*yt],t.push(a));let r=1+M(c,j,3);for(let l=0;r>l;l++){let l=t[h(c(),0,t.length-2)];At.lineWidth=f(c(),.7,1)*e*O,At.beginPath(),At.moveTo(l[0],l[1]),At.lineTo(a[0],a[1]),At.stroke(),At.beginPath(),At.moveTo(St-l[0],l[1]),At.lineTo(St-a[0],a[1]),At.stroke()}}}let Tt=v(kt);function xt(t,e){return Tt.data[4*(e*St+t)+3]}let $t=[];for(let t=0;vt>t;t++){$t[t]=[];for(let e=0;Ut>e;e++)$t[t][e]={l:t,h:e,x:Math.floor(bt+6*(t+.5)),y:Math.floor(Ct+6*(e+.5))}}let Bt=[$t[Math.floor(vt/2)][Math.floor(Ut/2)]];for(let t=0;Bt.length>t;t++){let e=Bt[t];if(e.l>0){let t=$t[e.l-1][e.h];t.M||(xt(t.x,t.y)?(t.M=1,Bt.push(t)):t.M=2)}if(vt-1>e.l){let t=$t[e.l+1][e.h];t.M||(xt(t.x,t.y)?(t.M=1,Bt.push(t)):t.M=2)}if(e.h>0){let t=$t[e.l][e.h-1];t.M||(xt(t.x,t.y)?(t.M=1,Bt.push(t)):t.M=2)}if(Ut-1>e.h){let t=$t[e.l][e.h+1];t.M||(xt(t.x,t.y)?(t.M=1,Bt.push(t)):t.M=2)}}for(let t=0;Bt.length>t;t++){let e=Bt[t],a=$t[vt-1-e.l][e.h];1!=a.M&&(a.M=1,Bt.push(a))}let Gt=Math.max(1,Math.floor(Bt.length*L)),Nt=I*Bt.length+Gt;function Rt(t,e){let a=Math.floor((t-bt)/6),l=Math.floor((e-Ct)/6);if(a>=0&&vt>a&&l>=0&&Ut>l)return 1==$t[a][l].M}function qt(t){return 1-t[1]/yt}function Dt(t,e){let a=Math.min(1,1-Math.abs(t[0]-mt)/mt);return e&&(a=Math.min(a,1-Math.abs(t[1]-wt)/wt)),a}function Jt(t,e,a,l,r,n,h){let M=(Dt(e,1)*(1-1/((St+yt)/1e3+1))*V**.5*(1-Wt/Nt))**a,o=8;if(d()<f(dt[t],l,r)*M){let a=f(pt[t],n,h);for(;d()<a*M&&Math.min(e[0]-o,St-e[0]-o,e[1]-o,yt-e[1]-o)>o/2;)o*=1.5}return o}function Pt(t,e,a){let l=At.createLinearGradient(e[0],e[1],2*t[0]-e[0],2*t[1]-e[1]),r=`rgba(0,0,0,${a})`;return l.addColorStop(0,r),l.addColorStop(.5,"rgba(0,0,0,0)"),l.addColorStop(1,r),l}kt.width|=0;let jt=[t=>{let e=Jt(0,t,.3,0,.9,0,.5),l=2*e,n=Math.ceil(f(d(),1,Math.max(2,e/2))),h=Math.ceil(f(d(),1,Math.max(2,e/2))),M=Math.min(n,h)*f(d(),.1,1.2),o=n+2*M,i=h+2*M,u=Math.ceil(l/o),c=Math.ceil(l/i),s=Math.round(u*o/2),p=Math.round(c*i/2),g=gt();At.fillStyle=`rgba(0,0,0,${f(d(),0,.25)})`,At.fillRect(t[0]-s-1,t[1]-p-1,o*u+2,i*c+2),At.fillStyle=r(g,f(d(),.4,1)),At.fillRect(t[0]-s,t[1]-p,o*u,i*c),At.fillStyle=r(g,f(d(),.4,1));for(let e=0;u>e;e++){let a=t[0]+M+e*o-s;for(let e=0;c>e;e++)At.fillRect(a,t[1]+M+e*i-p,n,h)}d()<a(e/8*(.6*Wt/Nt+.3),0,.98)&&(At.fillStyle=Pt(t,[t[0]+s,t[1]],f(d(),0,.9)),At.fillRect(t[0]-s,t[1]-p,o*u,i*c))},t=>{let e=Jt(1,t,.2,.3,1,0,.6),l=Math.ceil(f(d(),.8,2)*e),n=Math.ceil(f(d(),.8,2)*e),M=h(d(),3,Math.max(4,l)),o=Math.max(1,Math.round(l/M)),i=o*M,u=r(gt(),f(d(),.5,1)),c=f(d(),.3,.9);if(d()<a(z,0,1)){let e=[t[0]-Math.floor(i/2),t[1]-Math.floor(n/2)];At.fillStyle=`rgba(0,0,0,${f(d(),0,.25)})`,At.fillRect(e[0]-1,e[1]-1,i+2,n+2),At.fillStyle=u,At.fillRect(e[0],e[1],i,n);for(let a=0;o>a;a++)At.fillStyle=Pt([e[0]+(a+.5)*M,t[1]],[e[0]+a*M,t[1]],c),At.fillRect(e[0]+a*M,e[1],M,n)}else{let e=[t[0]-Math.floor(n/2),t[1]-Math.floor(i/2)];At.fillStyle=`rgba(0,0,0,${f(d(),0,.25)})`,At.fillRect(e[0]-1,e[1]-1,n+2,i+2),At.fillStyle=u,At.fillRect(e[0],e[1],n,i);for(let a=0;o>a;a++)At.fillStyle=Pt([t[0],e[1]+(a+.5)*M],[t[0],e[1]+a*M],c),At.fillRect(e[0],e[1]+a*M,i,M)}},t=>{let e=Jt(2,t,.05,0,1,0,.9),l=Math.ceil(f(d(),.6,1.4)*e),n=Math.ceil(f(d(),1,2)*e),h=Math.ceil(Math.max(l*f(d(),.7,1)/2,1)),M=Math.ceil(Math.max(l*f(d(),.8,1)/2,1)),o=Math.floor(a(l*f(d(),.05,.25),1,n)),i=Math.floor(a(l*f(d(),.1,.3),1,n)),u=o+i,c=d()<E**.5,s=Math.max(Math.floor(n/u),1),p=s*u+(c?o:0),g=gt(),S=f(d(),.6,1),m=f(d(),.6,1),v=r(g,S),b=r(g,m),y=1-f(d(),.5,.95),w=r(g,y*S),U=r(g,y*m);if(d()<F**.1){let e=At.createLinearGradient(t[0]-h,t[1],t[0]+h,t[1]),a=At.createLinearGradient(t[0]-M,t[1],t[0]+M,t[1]),l=Math.floor(t[1]-p/2);e.addColorStop(0,w),e.addColorStop(.5,v),e.addColorStop(1,w),a.addColorStop(0,U),a.addColorStop(.5,b),a.addColorStop(1,U);for(let r=0;s>r;r++)At.fillStyle=e,At.fillRect(t[0]-h,l+r*u,2*h,o),At.fillStyle=a,At.fillRect(t[0]-M,l+r*u+o,2*M,i);c&&(At.fillStyle=e,At.fillRect(t[0]-h,l+s*u,2*h,o))}else{let e=At.createLinearGradient(t[0],t[1]-h,t[0],t[1]+h),a=At.createLinearGradient(t[0],t[1]-M,t[0],t[1]+M),l=Math.floor(t[0]-p/2);e.addColorStop(0,w),e.addColorStop(.5,v),e.addColorStop(1,w),a.addColorStop(0,U),a.addColorStop(.5,b),a.addColorStop(1,U);for(let r=0;s>r;r++)At.fillStyle=e,At.fillRect(l+r*u,t[1]-h,o,2*h),At.fillStyle=a,At.fillRect(l+r*u+o,t[1]-M,i,2*M);c&&(At.fillStyle=e,At.fillRect(l+s*u,t[1]-h,o,2*h))}},t=>{if(d()<qt(t)-.3||Rt(t[0],t[1]+6*1.2)||Rt(t[0],t[1]+10.8))for(;;){let e=o(d,p);if(3!=e)return void jt[e](t)}let e=Jt(3,t,.1,.6,1,.3,.8),a=f(d(),1,2)*e,l=Math.ceil(f(d(),.3,1)*e),n=a*f(d(),.25,.6),h=(a+n)/4,M=Math.max(1,Math.ceil(l*f(d(),.08,.25))),i=M+Math.max(1,Math.ceil(l*f(d(),.03,.15))),u=Math.ceil(l/i),c=u*i+M,s=g[Y],S=At.createLinearGradient(t[0]-h,t[1],t[0]+h,t[1]),m=At.createLinearGradient(t[0]-h,t[1],t[0]+h,t[1]),v=Math.ceil(t[1]-c/2),b=v+M,y=v+i;S.addColorStop(0,r(s,K)),S.addColorStop(.5,r(s,H)),S.addColorStop(1,r(s,K)),m.addColorStop(0,r(s,Q)),m.addColorStop(.5,r(s,1)),m.addColorStop(1,r(s,Q)),At.fillStyle=S,At.beginPath(),At.moveTo(t[0]-n/2,v),At.lineTo(t[0]+n/2,v),At.lineTo(t[0]+a/2,v+c),At.lineTo(t[0]-a/2,v+c),At.fill(),At.fillStyle=m;for(let e=0;u>e;e++){let l=[b+e*i,y+e*i],r=[(n+(e*i+M)/c*(a-n))/2,(n+(e+1)*i/c*(a-n))/2];At.beginPath(),At.moveTo(t[0]-r[0],l[0]),At.lineTo(t[0]+r[0],l[0]),At.lineTo(t[0]+r[1],l[1]),At.lineTo(t[0]-r[1],l[1]),At.fill()}},t=>{let e,a=Dt(t,0),l=f(d(),.7,1),n=f(d(),0,.2),M=gt(),i=r(M,l),u=r(M,n),c=Math.max(3,Math.ceil(O*f(d(),.4,1)**2*X)),s=Math.floor(c/2),p=c%2,g=o(d,[Z**4*(2-a),.1*_**4,.2*tt**4*(1+a)]);if(g)if(2>g){let a=Math.min(Math.max(8,yt-t[1]-h(d(),0,16)),Math.floor(.6*O*d()**at)),l=t[0]-s,r=t[1],n=At.createLinearGradient(l,r,t[0]+s+p,r);n.addColorStop(0,u),n.addColorStop(.5,i),n.addColorStop(1,u),At.fillStyle=n,At.fillRect(l,r,c,a),e=[t[0],t[1]+a]}else{let a=At.createLinearGradient(t[0],t[1]-s,t[0],t[1]+s+p);a.addColorStop(0,u),a.addColorStop(.5,i),a.addColorStop(1,u),At.fillStyle=a,At.fillRect(t[0],t[1]-s,Math.ceil(mt-t[0])+1,c),e=[mt,t[1]]}else{let a=Math.min(Math.max(8,t[1]-h(d(),0,16)),Math.floor(.7*O*d()**et)),l=t[0]-s,r=t[1]-a,n=At.createLinearGradient(l,r,t[0]+s+p,r);n.addColorStop(0,u),n.addColorStop(.5,i),n.addColorStop(1,u),At.fillStyle=n,At.fillRect(l,r,c,a),e=[t[0],t[1]-a]}let S=[.6*lt**2,.2*rt**2,nt**2];if(jt[o(d,S)](t),Rt(e[0],e[1])){let t=[e[0]+Math.round(6*f(d(),-1,1)),e[1]+Math.round(6*f(d(),1,1))];jt[o(d,S)](Rt(t[0],t[1])?t:e)}},t=>{let e=Jt(5,t,.1,0,.9,0,.8),a=f(d(),.75,1),l=f(d(),0,.25),n=gt(),h=r(n,a),o=r(n,l),i=1+M(d,ft,Math.floor(1.2*(e/8)**.6)),u=1+M(d,ht,Math.floor(1.2*(e/8)**.6)),c=f(d(),.5,1)*e/Math.max(i,u),s=c+.5,p=[t[0]-c*i,t[1]-c*u];At.fillStyle=`rgba(0,0,0,${f(d(),0,.2)})`;for(let t=0;i>t;t++){let e=p[0]+(2*t+1)*c;for(let t=0;u>t;t++)m(At,e,p[1]+(2*t+1)*c,c+1)}for(let t=0;i>t;t++){let e=p[0]+(2*t+1)*c;for(let t=0;u>t;t++){let a=p[1]+(2*t+1)*c,l=At.createRadialGradient(e,a,c/5,e,a,s);l.addColorStop(0,h),l.addColorStop(1,o),At.fillStyle=l,m(At,e,a,s)}}},t=>{if(0>=Lt||d()<qt(t))return void jt[o(d,p.slice(0,6))](t);let e=Jt(6,t,.05,0,.9,0,.8),a=Math.ceil(2*e*f(d(),.6,1)),l=Math.floor(a/2),n=a%2,h=a*f(d(),Mt**.5,.9)**ot,M=Math.floor(h/2),i=Math.max((h-a)/2,a*(f(d(),0,.45)+f(d(),0,.45))*(.8>it?ut:ct)),u=Math.ceil(e*f(d(),.7,1)*st**.5),c=Math.floor(u/2),s=u%2,g=[[t[0]-c,t[1]+i-M],[t[0]+c+s,t[1]-l],[t[0]+c+s,t[1]+l+n],[t[0]-c,t[1]+i+M+a%2]],S=gt();At.fillStyle=`rgba(0,0,0,${f(d(),0,.2)})`,At.beginPath(),At.moveTo(g[0][0]-1,g[0][1]),At.lineTo(g[1][0]-1,g[1][1]),At.lineTo(g[2][0]-1,g[2][1]),At.lineTo(g[3][0]-1,g[3][1]),At.fill(),At.fillStyle=r(S,f(d(),.7,1)),At.beginPath(),At.moveTo(g[0][0],g[0][1]),At.lineTo(g[1][0],g[1][1]),At.lineTo(g[2][0],g[2][1]),At.lineTo(g[3][0],g[3][1]),At.fill()}],It=0,Lt=0,Vt=0,Wt=0;for(;;){let t;if(I>Lt)Bt.length>Vt?(t=Bt[Vt],Vt++):(Lt++,t=Bt[0],Vt=1);else{if(It>=Gt)break;t=Bt[h(d(),0,Bt.length-1)],It++}let e=[t.x,t.y];for(let a=0;10>a;a++){let a=[t.x+h(d(),-6,6),t.y+h(d(),-6,6)];if(!(0>a[0]||a[0]>St||0>a[1]||a[1]>yt)&&xt(a[0],a[1])){e=a;break}}6>Math.abs(e[0]-mt)&&d()<W&&(e[0]=mt),jt[o(d,p)](e),Wt++}return At.clearRect(St-mt,0,mt,yt),At.scale(-1,1),At.drawImage(kt,-St,0),kt}function U(t){let e=t.width,a=t.height,l=Math.max(12,Math.floor(Math.min(e,a)/12)),r=v(t),n=Math.floor(e/l),f=Math.floor(a/l),h=[],M=Math.floor(a/f/2);for(let t=0;f>t;t++){let l=Math.floor(e/((2-t%2)*n));for(let r=0;n-t%2>r;r++)h.push([1e9,1e9,0,0,l+(r+(Math.random()-.5))*e/n,M+(t+(Math.random()-.5))*a/f,[]])}for(let t=0;a>t;t++)for(let a=0;e>a;a++){let l=4*(t*e+a);if(r.data[l+3]){let e,n=1e9;h.map(l=>{let r=Math.hypot(l[4]-a,l[5]-t);n>r&&(n=r,e=l)}),e[0]=Math.min(a,e[0]),e[2]=Math.max(a,e[2]),e[1]=Math.min(t,e[1]),e[3]=Math.max(t,e[3]),e[6].push([a,t,r.data.slice(l,l+4)])}}let o=[];return h.sort((t,e)=>e[6].length-t[6].length).map(t=>{if(1e9>t[0]){let e=t[2]-t[0]+1,a=t[3]-t[1]+1,[l,r]=S(e,a),n=v(l);t[6].map(a=>n.data.set(a[2],4*((a[1]-t[1])*e+(a[0]-t[0])))),r.putImageData(n,0,0),o.push([t[4],t[5],t[0]-t[4],t[1]-t[5],l])}}),o}function C(t,e,a){let l=t[0]-e/2,r=t[1]-a/2,n=Math.hypot(l,r),f=n**2,h=n*(.5+1.5*Math.random());return[...t,h*(1-r**2/f)**.5*(l>0?1:-1),h*(1-l**2/f)**.5*(r>0?1:-1),3*(Math.random()-.5)]}let k=new(window.AudioContext||webkitAudioContext),A=([t,e,a,l=.06,r=4,n=0,f=0,h=0,M=0,o=0,i=.1,u=.04,c=0,s=0,d=0,p=.04,g=0,S=0,m=0])=>{let v,b,y,w,U=2*Math.PI,C=n*=500*U/44100/44100,A=t*=(1+0*Math.random()-0)*U/44100,O=[],T=0,x=0,$=0,B=1,G=0,N=0,R=0;for(o*=500*U/44100**3,s*=U/44100,m*=U/44100,S*=44100,g=44100*g|0,b=(h=44100*h+9)+(p*=44100)+(l*=44100)+(e*=44100)+(M*=44100)|0;b>$;O[$++]=R)++N%(100*c|0)||(R=r?r>1?r>2?r>3?Math.sin((T%U)**3):Math.max(Math.min(Math.tan(T),1),-1):1-(2*T/U%2+2)%2:1-4*Math.abs(Math.round(T/U)-T/U):Math.sin(T),R=(g?1-f+f*Math.sin(U*$/g):1)*(R>0?1:-1)*Math.abs(R)**i*u*.3*(h>$?$/h:h+p>$?1-($-h)/p*(1-a):h+p+l>$?a:b-M>$?(b-$-M)/e*a:0),R=M?R/2+(M>$?0:(b-M>$?1:(b-$)/M)*O[$-M|0]/2):R),v=(t+=n+=o)*Math.cos(s*x++),T+=v-v*d*(1-1e9*(Math.sin($)+1)%2),B&&++B>S&&(t+=m,A+=m,B=0),!g||++G%g||(t=A,n=C,B||=1);return y=k.createBuffer(1,b,44100),y.getChannelData(0).set(O),w=k.createBufferSource(),w.buffer=y,w.connect(k.destination),w.start(),w};function O(){A([467,.14,.58,,,,.02,,,,,.1,.4,303,.5,.02])}function T(t){A([274,.67,.63,.03,,,,,.25,,1.11,t,.5,,.8,.02,.04])}function x(){A([279,.09,.89,.09,3,-4.9,.02,.02,.05,-.6,1.2,.15])}function $(t,e,a){W.drawImage(t,Math.round(e),Math.round(a))}function B(t){W.save(),t(),W.restore()}function G(t){let[e,a]=S(t.width,t.height),l=v(t),r=l.data;for(let t=0;r.length>t;t+=4){let[e,a,l]=r.slice(t,t+4);r.set([255-(.393*e+.769*a+.189*l),255-(.349*e+.686*a+.168*l),255-(.272*e+.534*a+.131*l)],t)}return a.putImageData(l,0,0),e}function N(t,e){return R(t,e,6,"#0ff","#00f")}function R(t,e,a,l,r){let[n,f]=S(20*t,20*t);return f.translate(9*t,9*t),f.rotate(e),f.fillStyle="#ff0",f.beginPath(),f.moveTo(t,t*a),f.lineTo(0,t),f.arc(t,t,t,Math.PI,0),f.lineTo(t,t*a),f.fill(),f.strokeStyle=l,f.shadowColor=r,f.globalCompositeOperation="source-atop",f.shadowBlur=Math.round(t/2),f.lineWidth=t/2,f.beginPath(),f.moveTo(t,t*a),f.lineTo(0,t),f.arc(t,t,t,Math.PI,0),f.lineTo(t,t*a),f.stroke(),n=y(n),[n,v(n).data]}function q(t,e){let[a,l]=S(t,t),r=l.createRadialGradient(t/2,t/2,0,t/2,t/2,t/2);return r.addColorStop(e,"#ff0"),r.addColorStop(1,"#f00"),l.fillStyle=r,m(l,t/2,t/2,t/2),a}function D(t){let e=[];for(let a=9;a--;)e.unshift(q(t,a/10)),e.push(q(t,a/10));return[e,v(e[0]).data]}function J(t){let[e,a]=S(t.width,t.height);return a.scale(1,-1),a.drawImage(t,0,0,t.width,-t.height),e}let P,j,I,L=["#9af","#abf","#ccf","#fef","#fee","#fc9","#fc6"],V=g,W=d(V),z=[],E=["Main Gun","Side Cannon","Shield","Bombs","Magnet"],F=["Andromeda","Borealis","Cygnus","Draco","Endgame","Survival"],H=[R(5,0,4,"#f80","#f00"),R(4,0,4,"#f80","#f00")],K=[N(6,-.245),N(6,0),N(6,.245)],Q=[N(10,-.245),N(10,0),N(10,.245)],Y=[D(8),D(14),D(20),D(28)],X=JSON.parse(localStorage.pnf_settings||0)||{o:0,s:0,i:E.map(()=>0),c:0,f:0};function Z(){j=y(w(X.c||1301,5,114,40)),I=U(j)}Z();let _,tt,et,at,lt,rt,nt,ft,ht,Mt,ot,it,ut,ct,st,dt,pt,gt,St,mt,vt,bt,yt,wt,Ut,Ct,kt,At,Ot=j.width,Tt=j.height,xt=Math.floor(Ot/2),$t=Math.floor(Tt/2),Bt=v(j).data,Gt=[],Nt=performance.now(),Rt=["\u21e6 Main Menu",Jt];function qt(t,e){let a=10**(X.i[e]+1),l=[];l.push(!e||X.i[e]?"Quality: "+(X.i[e]?"\u2b50".repeat(X.i[e]):"Standard"):"Not Acquired"),3>X.i[e]&&l.push([(!e||X.i[e]?"Upgrade":"Buy")+": "+a.toLocaleString()+" \u267a",X.s>=a&&(()=>{X.i[e]++,Vt(-a),qt(t,e)})]),l.push(["\u21e6 Back",()=>Lt("Upgrades",Dt(),e)]),Lt(t,l)}function Dt(){return[...E.map((t,e)=>["\u2b50".repeat(X.i[e])+" "+t,()=>qt(t,e)]),["Refund All Upgrades",X.i.some(t=>!!t)?()=>{let t=0;X.i=X.i.map(e=>{for(let a=1;e>=a;a++)t+=10**a;return 0}),Vt(t),Lt("Upgrades",Dt(),0)}:0],Rt]}function Jt(){let t=[["Play",Pt],["Upgrades",()=>Lt("Upgrades",Dt())],["Top Scores",X[0]?()=>Lt("Top Scores",(()=>{let t=[];for(let e=0;X[e];e++)t.push("\u{1f3c6} "+F[e]+": "+X[e].toLocaleString()+" points");return t.push(Rt),t})()):0],["Supporter Options",()=>Lt("Supporter Options",jt())]];Lt("Galaxy Raid",t,0,1)}function Pt(){let t=[];for(let e=0;6>e;e++){let a=e;t.push(e>X.o?["\u{1f512} "+F[a]]:[F[a],()=>Yt(a)])}t.push(Rt),Lt("Select Mission",t,X.o)}function jt(){let t=[],e="started"==document.monetization?.state;return e||t.push("Coil not detected"),t.push(["Ship Color",e&&(()=>Lt("Ship Color",It()))]),t.push(["Claim "+1e3.toLocaleString()+" \u267a",e&&!X.f&&(()=>{Vt(1e3),X.f=1,Et(),Lt("Supporter Options",jt())})]),t.push(["Unlock All Missions",e&&X.o-5&&(()=>{X.o=5,Et(),Lt("Supporter Options",jt())})]),t.push(Rt),t}function It(){return[j,["Randomize",()=>{X.c=h(Math.random(),0,1e9),Et(),Z(),Lt("Ship Color",It())}],["\u21e6 Back",()=>Lt("Supporter Options",jt())]]}function Lt(e,a,l=0,r){let n;b.textContent=r?"By @joseprio for JS1K 2021":"",t.style.transition="",t.className=r?"b":"",t.textContent=e,c.textContent="",a&&a.map((t,e)=>{if(t.map){let a=document.createElement("button");a.textContent=t[0],t[1]?a.onpointerdown=e=>{e?.preventDefault(),t[1]()}:a.setAttribute("d",""),c.appendChild(a),n||l>e||a.hasAttribute("d")||(n=a.style.transition="none",a.focus(),a.style.transition="")}else if(t.width){let e=document.createElement("div");e.appendChild(t),c.appendChild(e)}else{let e=document.createElement("p");e.textContent=t,c.appendChild(e)}})}function Vt(t){X.s+=t,Et(),s.textContent="\u267a: "+X.s.toLocaleString()}Jt(),Vt(0),(self.onorientationchange=self.onresize=()=>{document.documentElement.style.setProperty("--s",Math.min(innerWidth/480,innerHeight/700))})();for(let t=0;10>t;t++){let[e,a]=S(Ot+20,Tt+20),l=t?0:10;for(let t=-1;2>t;t++)for(let e=-1;2>e;e++)a.drawImage(z[0]||j,e+l,l+t);a.globalCompositeOperation="source-in",a.fillStyle=t>5?"#0ff":"#00f",a.fillRect(0,0,1e9,1e9),a.globalCompositeOperation="source-over",t&&a.drawImage(z[0],0,0),z.unshift(e)}function Wt(t){yt+=t,p.textContent=yt.toLocaleString(),X[Mt]&&X[Mt]>=yt||(X[Mt]=yt,Et(),dt=1),i.textContent="TOP: "+X[Mt].toLocaleString()}function zt(){b.textContent="\u{1f4a5} ".repeat(St)}function Et(){localStorage.pnf_settings=JSON.stringify(X)}z.map(t=>{let e=d(t);e.globalCompositeOperation="destination-out",e.globalAlpha=.2;for(let t=5;9>t;t++)e.drawImage(z[t],0,0)}),z.length=5;let Ft=[[34,145,300],[141,50,200],[1905,111,220],[2514,491,220],[2066,334,300],[269,101,250]],Ht=[12,255,552,589,308,8],Kt=[1,2e3,3e3,4e3,0,6e3],Qt=[[[34,213,0,0,10,.35],[34,9,80,0,30,.35,1e3,t=>t(0,.3)],[34,18,100,0,50,.25,1e3,(t,e,a)=>(t(0,.3),a%3?250:1e3),150],[34,73,310,0,100,.15,0,0,0,[1,8,.45]]],[[20,18,40,0,30,.35,700,t=>t(0,.3)],[20,91,80,0,60,.3,550,(t,e,a)=>{if(e(0,8,Math.PI/8,.3),3>a)return 200}],[20,9,120,0,140,.15,800,(t,e,a)=>{let l=a%3;return t(1,.3),l?250:1e3}],[109,203,40,0,80,.55,0,0,0,0,.002]],[[51,91,120,0,120,.15,0,0,0,[1,11,.45]],[51,9,60,[3,300],30,.4,800,t=>t(0,.3)],[51,156,100,0,120,.35,800,(t,e,a)=>{let l=a%4;return t(1,.3+(a-1)%4*.05),l?50:800}],[51,11,100,0,80,.35,800,(t,e,a)=>{let l=a%4;return l?t(0,.3):e(0,8,0,.3),l?250:1e3},150]],[[89,218,60,0,40,.4,600,(t,e,a)=>{if(t(0,.3,1,Math.PI/24),3>a)return 200}],[89,50,100,0,120,.4,800,(t,e,a)=>{let l=a%10;return 4>l?t(2,.4):e(0,5,l*Math.PI/12,.3),3>l?200:3==l?500:9>l?100:800},150],[1492,43,40,[3,300],40,.55,0,0,0,0,.002],[320,397,120,0,200,.15,1400,(t,e,a)=>{if(e(0,12,a%2?0:Math.PI/12,.3+.1*a),4>a)return 100}]],[],[]];function Yt(t){Lt("Please wait\u2026"),wt=1,P=[],Ut=[],Ct=[],kt=[],At=[],Mt=t,ot=Mt-5?t:0}let Xt=0,Zt=0,_t=0;function te(t){let e=[...c.children],a=e.indexOf(document.activeElement);do{a+=t,e[a]||(a=t>0?0:e.length-1)}while(e[a].hasAttribute("d"));e[a].focus()}function ee(t,e){let a=Math.round(t[0]-t[2]/2),l=Math.round(t[1]-t[3]/2),r=Math.round(e[0]-e[2]/2),n=Math.round(e[1]-e[3]/2);if(r+e[2]>a&&a+t[2]>r&&n+e[3]>l&&l+t[3]>n){let f=Math.min(a+t[2],r+e[2]),h=Math.min(l+t[3],n+e[3]),[M,o,i]=a>r?[0,a-r,f-a]:[r-a,0,f-r],[u,c,s]=l>n?[0,l-n,h-l]:[n-l,0,h-n];for(let a=0;s>a;a++)for(let l=0;i>l;l++)if(t[4][4*((u+a)*t[2]+M+l)+3]>0&&e[4][4*((c+a)*e[2]+o+l)+3]>0)return 1}}function ae(t,e){gt?(gt--,A([119,.44,.85,0,0,5.3,,,.01,-4.2,.09,.9,.1,-340,.7,.08])):ke(t,e)}function le(t,e){return(a,l)=>{if(t>a)return 1;e(a,l)}}function re(t,e,a,l,r,n){return f=>{let h=[t+=.625*(l-1)*(f-n)/4,e-=.625*(f-n),a[0].width,a[0].height,a[1]];for(let t=0;ce.length>t;t++)if(ce[t](h,r,f))return;if(e+a[0].height/2>0)return n=f,$(a[0],t-a[0].width/2,e-a[0].height/2),1}}function ne([t,e,a,l,r,n,f,h],M,o,i,u){return c=>{let s=(c-u)/i;if(1>s)return B(()=>{W.globalAlpha=1-s**2,W.translate(M+t+n*s,o+e+f*s),W.rotate(h*s),$(r,a,l)}),1}}let fe=["#710","#a21","#d42","#e93","#fa5"];function he(t,e,a,l,r){let n=f(Math.random(),10,50),M=fe[h(Math.random(),0,fe.length-1)],o=t+h(Math.random(),-a/2,a/2),i=e+h(Math.random(),-l/2,l/2);return t=>{let e=(t-r)/500;if(1>e)return B(()=>{W.globalCompositeOperation="lighter",W.fillStyle=M,W.beginPath(),W.arc(o,i,n*(1-e),0,7),W.fill()}),1}}function Me(t,e){return Math.atan2(nt-t,ft-e)}function oe(t,e,a,l,r,n){let[f,h]=Y[t],M=f[0].width,o=f[0].height,i=r*Math.cos(l),u=r*Math.sin(l);return(t,l,r)=>{if(pt>t)return;let c=t-n;return ee(it,[e+=c*u,a+=c*i,M,o,h])&&(ae(t,r),!ut)||a-o/2>700||0>a+o/2||e-M/2>480||0>e+M/2?void 0:(n=t,$(f[t%f.length|0],e-M/2,a-o/2),2)}}function ie(t,e,a,l,r,n,f,h){for(let M=0;a>M;M++)t.push(oe(e,l,r,n+2*M*Math.PI/a,f,h))}let ue,ce,se,de,pe,ge,Se,me,ve=[1e3,2e3,2e3,3e3,4e3];function be(t){let a,r,n=4==Mt?bt:Mt,f=4==Mt?n:0,h=Ut[f],M=Ct[f],o=kt[f],i=At[f],u=h.width,c=h.height,s=0,d=1e9,p=1e9,g=t,S=240,m=-800,v=1,b=n-3?0:2,y=0,w=0,U=0;function k(t,e,r){if(ee(t,a))return 4==n&&d>=p/2&&p/2>d-e&&(U=1),y=r,d-=e,l.style.width=100*d/p+"%",d>0&&O(),1}return e.style.opacity=1,l.style.width="100%",(t,f,O)=>{let T=0;if(d>0)if(U)U=0,i.map(e=>O.push(ne(C(e,u,c),S-u/2,m-c/2,500,t))),n++,h=Ut[n],M=Ct[n],o=kt[n],i=At[n],u=h.width,c=h.height,r=t+1e3,w=0;else{let e=t-g;if(s)if(n>4){if(!ut){let t=Me(S,m);S+=.1*Math.sin(t)*e,m+=.1*Math.cos(t)*e}}else n&&(1==v?(S+=.1*e,S+u/2>480&&(S=480-u/2,1==n||3==n||4==n?v=2:2==n&&(v=0,b=2))):2==v&&(S-=.1*e,0>S-u/2&&(S=u/2,1==n||3==n||4==n?v=1:(v=0,b=1))),2==b?(m+=.1*e,m+c/2>700&&(m=700-c/2,2==n?(b=0,v=2):b=1)):1==b&&(m-=.1*e,0>m-c/2&&(m=c/2,2==n?(b=0,v=1):b=2)));else m+=.2*e,m>150&&(m=150,p=d=ve[n],s=1,r=t)}else T=1;if(T){e.style.opacity="",l.style.width="",A([369,1,.77,.1,2,.4,,,.37,,.05,1.1,.8,-1.3,.7]),Wt(1e3*(n+1)),i.map(e=>f.push(ne(C(e,u,c),S-u/2,m-c/2,500,t)));for(let e=0;Math.ceil(u*c/500)>e;e++)f.push(he(S,m,u,c,t));return void(Mt-4||4==bt?(G=t,ut||(ct=1,X.o=Math.max(Mt+1,X.o),Et(),st=G+3500,pt=G+1e3,Ce("Well Done"))):(bt++,f.push(le(t+3e3,(t,e)=>e.push(be(t))))))}var G;a=[S,m,u,c,M],ee(it,a)&&ke(t,O),g=t,$(h,S-u/2,m-c/2);let N=400-t+y;if(N>0&&B(()=>{W.globalAlpha=N/400,$(o,S-u/2,m-c/2)}),!ut&&1==s&&t>r)if(x(),0==n){if(5>w){let e=m+125;f.push(oe(0,S,e,Me(S,e),.3,t))}else ie(f,1,16,S,m,w-5?0:Math.PI/16,.5,t);w++,w>6?(w=0,r=t+800):r=w>4?t+100:t+200}else if(1==n){if(8>w){let[e,a]=[[61,75],[78,66],[99,76],[115,65]][Math.floor(w/2)];f.push(oe(1,S-e,m+a,0,.6,t),oe(1,S+e,m+a,0,.6,t))}else{let e=m+77;f.push(oe(3,S,e,Me(S,e),.35+.1*(w-8),t))}w++,w>16?(w=0,r=t+800):r=w>8?t+100:8==w?t+500:w%2?t+100:t+200}else if(2==n){if(8>w){let e=Me(S,m);f.push(oe(2,S+70*Math.sin(e),m+70*Math.cos(e),e,.4,t))}else ie(f,1,3,S,m,w*Math.PI/10,.35,t);w++,w>30?(w=0,r=t+800):r=9>w?t+300:t+50}else if(3==n){if(20>w)ie(f,2,2,S,m,Math.PI/20+w*Math.PI/10,.4,t),ie(f,2,2,S,m,-Math.PI/20-w*Math.PI/10,.4,t);else{let e=Me(S,m),a=S+70*Math.sin(e),l=m+70*Math.cos(e);f.push(oe(1,a,l,e-Math.PI/8,.5,t)),f.push(oe(1,a,l,e+Math.PI/8,.5,t)),f.push(oe(3,a,l,e,.5,t))}w++,20==w?r=t+1500:w>25?(w=0,r=t+1500):r=w>20?t+150:t+50}else if(4==n){if(12>w){let[e,a]=[[48,113],[79,107],[99,108],[123,102],[156,86],[166,59]][w>5?11-w:w];f.push(oe(2,S-e,m+a,0,.6,t),oe(2,S+e,m+a,0,.6,t))}else{let e=S+(w%2?21:-21),a=m+112,l=Me(e,a);f.push(oe(3,e,a,l,.4,t)),f.push(oe(2,e,a,l-Math.PI/8,.4,t)),f.push(oe(2,e,a,l+Math.PI/8,.4,t)),f.push(oe(1,e,a,l-Math.PI/4,.4,t)),f.push(oe(1,e,a,l+Math.PI/4,.4,t))}w++,w>16?(w=0,r=t+800):r=w>12?t+150:t+100}else ie(f,3,8,S,m,w%2?0:Math.PI/8,.4,t),w++,w>1?(w=0,r=t+800):r=t+200;return k}}function ye(){return(navigator.getGamepads?[...navigator.getGamepads()]:[]).filter(t=>!!t)}function we(t){let e=ye();for(let a=0;e.length>a;a++)try{if(e[a].buttons[t].pressed)return 1}catch(t){}}function Ue(t){let e=ye(),a=0;for(let l=0;e.length>l;l++)try{a+=e[l].axes[t]}catch(t){}return Math.round(100*a)/100}function Ce(e){t.style.transition="",t.style.opacity=0,t,t.textContent=e,t.style.transition="all 3s ease",t.style.opacity=1}function ke(t,e){ut||ct||(ut=1,T(1),st=t+3500,I.map(a=>{e.push(ne(C(a,Ot,Tt),nt-xt,ft-$t,1500,t))}),Ce("Signal Lost"))}function Ae(t){let e=g.getBoundingClientRect();return[Math.floor(480*(t.pageX-e.left)/e.width),Math.floor(700*(t.pageY-e.top)/e.height)]}self.onmousedown=t=>{t.preventDefault(),ht=1},self.onmouseup=t=>{t.preventDefault(),ht=0},self.ontouchcancel=self.ontouchend=self.ontouchmove=self.ontouchstart=t=>{let e=t.touches;if(t.preventDefault(),et=e.length>1,null!=at)for(let t=0;e.length>t;t++)if(e[t].identifier==at){let[a,l]=Ae(e[t]);return lt+=a-_,rt+=l-tt,_=a,void(tt=l)}if(e.length>0)return at=e[0].identifier,void([_,tt]=Ae(e[0]));at=null},self.onmousemove=t=>{t.preventDefault(),[lt,rt]=Ae(t)},self.onkeydown=self.onkeyup=t=>{t.preventDefault(),Gt[t.keyCode]=t.type[5]},V.width=480,V.height=700,function a(r){wt>1?(a=>{let r=a-me;me=a,r>200&&(Nt+=r-40,r=40,Gt=[],ht=et=0);let n=a-Nt;if(3==wt&&!ut&&!ct){let t=.6*r,e=Ue(0),a=Ue(1);if((Gt[38]||Gt[87]||Gt[90]||we(12))&&a--,(Gt[40]||Gt[83]||we(13))&&a++,(Gt[37]||Gt[65]||Gt[81]||we(14))&&e--,(Gt[39]||Gt[68]||we(15))&&e++,Gt[13]||Gt[32]||we(0)||we(1)||we(2)||we(3)||we(9)||ht||et?mt||(f=n,St&&f>pt&&(St--,zt(),T(1.5),pt=f+1e3,pe+=1500,ge+=1500),mt=1):mt=0,e||a){let l=Math.max(Math.hypot(e,a),1);nt+=t*e/l,ft+=t*a/l,lt=nt,rt=ft}else{let e=lt-nt,a=rt-ft,l=Math.hypot(e,a);l>t?(nt+=e/l*t,ft+=a/l*t):(nt=lt,ft=rt)}xt>nt?nt=xt:nt>480-xt&&(nt=480-xt),$t>ft?ft=$t:ft>700-$t&&(ft=700-$t),it=[nt,ft,Ot,Tt,Bt]}var f;ct&&n+2500>st&&(ft+=.6*r*(st-3e3-n)/2e3),2==wt&&(rt=ft=700+$t-Math.min(1,2*n/2500)*(Tt+20)),W.fillStyle="#002",W.fillRect(0,0,1e9,1e9);for(let t,e=100;e--;W.fillStyle=L[e%L.length],m(W,-60*(1-e/100)*nt/(480-Ot)+102797*(1+Math.sin(t))*e%540,700*(Math.tan(e/9)+t*n/3e3)%700,3.3*(t-.3)))t=150/(3*e+200);let M=[],o=[],u=[];if(ue.map(function t(e){let a=[],l=e(n,a,o);l&&(2==l?o.push(e):M.push(e),l.call&&u.push(l)),a.map(t)}),ue=M.concat(o),ce=u,!ut){if(gt){let t=z[Math.max(0,z.length-gt)];$(t,nt-Math.floor(t.width/2),ft-Math.floor(t.height/2))}let t=H[h(Math.random(),0,1)][0];$(t,nt-t.width/2,ft+$t-1),$(j,nt-xt,ft-$t)}if(pt>n&&B(()=>{W.globalAlpha=(pt-n)/1e3,W.fillRect(0,0,1e9,1e9)}),3==wt&&!ut&&!ct&&n>se+200){let[t,e]=X.i[1]>2?[Q,20]:[K,10];(X.i[1]&&!vt||X.i[1]>1&&1==vt)&&(ue.push(re(nt-25,ft-Math.floor(Tt/2),t[0],0,e,n)),ue.push(re(nt+25,ft-Math.floor(Tt/2),t[2],2,e,n)));let[a,l]=X.i[0]%2?[Q,20]:[K,10];X.i[0]>1?(ue.push(re(nt-12,ft-Math.floor(Tt/2),a[1],1,l,n)),ue.push(re(nt+12,ft-Math.floor(Tt/2),a[1],1,l,n)),2==X.i[0]&&ue.push(re(nt,ft-Math.floor(Tt/2)-12,a[1],1,l,n))):ue.push(re(nt,ft-Math.floor(Tt/2),a[1],1,l,n)),se=n,A([292,.08,.74,.01,3,-3.9,.43,.02]),vt=(vt+1)%4}if(n>ge&&!Se&&(++bt%6?ge=n+1e4:Mt-5&&(Se=1,ue.push(be(n)))),!Se&&n>pe){let t=h(de(),0,Math.min(bt,P.length-1)),e=h(de(),30,450),a=50*(t+1),l=(l,r)=>r.push((([t,e,a,l,r,n,f,M,o,i,u,c],s,d,p)=>{let g,m=t.width,b=t.height,y=-b/2,w=0,U=p,k=M&&p+M,G=0,N=ut?0:Me(s,y);function R(t,e,a){if(ee(t,g))return w=a,(n-=e)>0&&O(),1}return(r,M,p)=>{let O=r-U,q=400-r+w,D=0;if(0>=n||pt>r)D=1;else{if(c){if(!ut&&ft>y){let t=Me(s,y)-N,e=Math.atan2(Math.sin(t),Math.cos(t)),a=c*O;N+=0>e?Math.max(e,-a):Math.min(e,a)}s+=O*f*Math.sin(N),y+=O*f*Math.cos(N)}else y+=O*f;!ut&&i&&(y=Math.min(y,i)),g=[s,y,m,b,e],ee(it,g)&&(ae(r,p),ut||(D=1))}if(D){T(m/275),u&&ie(M,u[0],u[1],s,y+17*f,2*Math.PI/u[2],u[2],r);let t=h(Math.random(),0,l.length/2);l.map((e,a)=>M.push(t-a?ne(C(e,m,b),s-m/2,y-b/2,500,r):(([t,e,a,l,r,n,f],h,M,o)=>{let i=h+t+a,u=M+e+l,c=o,s=Math.atan2(f,n),d=v(r).data,p=.2+.1*X.i[4],[g,m]=S(r.width,r.height);return m.drawImage(r,0,0),m.fillStyle="#fff",m.globalCompositeOperation="source-in",m.fillRect(0,0,g.width,g.height),t=>{let e=(t-c)/500,a=t-o,l=Math.hypot(nt-i,ft-u);if(80*X.i[4]>l){let t=Me(i,u);i+=Math.sin(t)*p*a,u+=Math.cos(t)*p*a}else 1>e&&(i+=3*(1-e)*Math.cos(s),u+=3*(1-e)*Math.sin(s),(0>i||i>480-r.width)&&(s+=Math.PI)),u+=.1*a;return!ut&&ee(it,[i,u,r.width,r.height,d])?(Vt(1),void A([1675,.24,1,,1,,,,,,1.82,,,,,0,,.06,837])):u>700?void 0:(o=t,$(r,i-r.width/2,u-r.height/2),B(()=>{W.globalAlpha=.5+Math.sin(t/100)/2,$(g,i-r.width/2,u-r.height/2)}),1)}})(C(e,m,b),s-m/2,y-b/2,r)));for(let t=0;Math.ceil(m*b/500)>t;t++)M.push(he(s,y,m,b,r));return Wt(d)}if(700>=y-b/2){if($(t,s-m/2,y-b/2),q>0&&B(()=>{W.globalAlpha=q/400,$(a,s-m/2,y-b/2)}),!ut&&k&&r>k){let t=y+17*f;x();let e=o((e,a,l,n)=>{let f=Me(s,t);if(M.push(oe(e,s,t,f,a,r)),l)for(let h=0;l>h;h++)M.push(oe(e,s,t,f+(h+1)*n,a,r),oe(e,s,t,f-(h+1)*n,a,r))},(e,a,l,n)=>{ie(M,e,a,s,t,l,n,r)},++G);k=e&&k+e}return U=r,R}}})(P[t],e,a,l));if(P[t][4])for(let e=0;P[t][4][0]>e;e++)ue.push(le(n+(e+1)*P[t][4][1],l));l(n,ue),pe+=Math.max(0,1e3-50*bt)+Math.round(400*de())}st&&n>st&&(i.textContent=p.textContent="",e.style.transition="initial",e.style.opacity="",l.style.width="",e,e.style.transition="",(()=>{let t=[];t.push("You got "+yt.toLocaleString()+" points"),dt&&t.push("New Top Score!"),t.push(ct?["Next, "+F[Mt+1],()=>Yt(Mt+1)]:["Try Again",()=>Yt(Mt)]),t.push(["Upgrades",()=>Lt("Upgrades",Dt())]),yt&&t.push(["Tweet Score",()=>open("//twitter.com/intent/tweet?hashtags=js13k&url="+location+"&text="+encodeURIComponent("I got "+yt.toLocaleString()+" points in Galaxy Raid's "+F[Mt]+" mission!"))]),t.push(Rt),Lt(Mt-5?ct?Mt-4?"Victory":"Total Victory!!":"Defeat":"Good Try",t)})(),wt=0),2==wt&&n>2500&&(wt=3,t.style.opacity=0,t.style.transition="all .5s ease",4==Mt&&ue.push(be(n)))})(r):(t=>{W.fillStyle="#002",W.fillRect(0,0,1e9,1e9);for(let e=100;e--;){W.fillStyle=L[e%L.length];let a=100/(4-(t/1e3+e/13)%4);m(W,Math.cos(e)*a+240,Math.sin(e*e)*a+350,a/100)}let e=Ue(1);Gt[38]||Gt[87]||Gt[90]||we(12)||-.8>e?Zt||(te(-1),Zt=1):Zt=0,Gt[40]||Gt[83]||we(13)||e>.8?Xt||(te(1),Xt=1):Xt=0,Gt[13]||Gt[32]||we(0)||we(1)||we(2)||we(3)||we(9)?_t||(document.activeElement.onpointerdown(),_t=1):_t=0,wt&&(Mt-5&&(!Ut.length||4==Mt&&Ut.length-Ft.length)?(()=>{let t=[...Ft[4==Mt?Ut.length:Mt]],e=J(y(w(Ht[Mt],...t)));Ut.push(e),kt.push(G(e)),At.push(U(e)),Ct.push(v(e).data)})():ot==Mt||5==Mt&&Qt.length>ot?P.push(...Qt[ot++].map(t=>(([t,e,a,...l])=>{let r=y(J(w(Ht[Mt],t,e,a)));return[r,v(r).data,G(r),U(r),...l]})(t))):(Ce("Good Luck"),wt=2,de=u(Kt[Mt]),pe=3500,ge=7500,ue=[],ce=[],me=Nt=performance.now(),St=X.i[3],Se=4==Mt,Wt(ut=ct=bt=se=pt=yt=st=vt=dt=0),zt(),lt=nt=240,ft=700+$t,gt=X.i[2]))})(r),requestAnimationFrame(a)}(Nt);</script>